!function(t){var e;function n(t,n){i.init(t);var a=e||mobilenet.load(),o=new Promise(function(t,e){var i=new Image;i.onload=function(){!function(t,e){var n,i;t.width>t.height?(n=224,i=224*t.height/t.width):(n=224*t.width/t.height,i=224);let a=document.createElement("canvas");EXIF.getData(t,function(){var o=0;if(EXIF.pretty(this)){var c=EXIF.getAllTags(this).Orientation;6==c?o=90:3==c?o=180:8==c&&(o=270)}90==o||270==o?(a.width=i,a.height=n):(a.width=n,a.height=i);let l=a.getContext("2d");l.clearRect(0,0,n,i),o&&o>0&&(l.rotate(o*Math.PI/180),90==o?l.translate(0,-i):180==o?l.translate(-n,-i):270==o&&l.translate(-n,0)),l.drawImage(t,0,0,t.width,t.height,0,0,n,i),window.URL.revokeObjectURL(t.src),e(a)})}(i,t)},i.src=window.URL.createObjectURL(n.getNative())});Promise.all([a,o]).then(function(t){var n=t[0],i=t[1];return e||(e=n),n.classify(i)}).then(function(e){i.setCaption(t,e[0].className)})}"function"==typeof wp.Uploader?t.extend(wp.Uploader.prototype,{init:function(){this.uploader.bind("BeforeUpload",function(t,e){n(e.attachment.cid,e)})},success:function(t){i.setAttachment(t.cid,t)}}):t(document).ready(function(t){"undefined"!=typeof uploader&&(uploader.bind("BeforeUpload",function(t,e){n(e.id,e)}),uploader.bind("FileUploaded",function(t,e,n){i.setPostId(e.id,n.response)}))});var i={image:{},init:function(t){this.image[t]={caption:null,attachment:null,postId:null}},setCaption:function(t,e){"undefined"!=typeof wirGl_localize&&void 0!==wirGl_localize[e]&&(e=wirGl_localize[e]),this.image[t].caption=e,this.setImageCaption(t)},setAttachment:function(t,e){this.image[t].attachment=e,this.setImageCaption(t)},setPostId:function(t,e){this.image[t].postId=e,this.setImageCaption(t)},setImageCaption:function(e){var n=this.image[e];null!==n.caption&&(null!==n.attachment?(n.attachment.save("caption",n.caption),delete this.image[e]):null!==n.postId&&(t.ajax({type:"POST",url:wirGl.ajaxUrl,dataType:"json",data:{action:"set_image_caption",nonce:wirGl.nonce,post_id:n.postId,caption:n.caption}}).done(function(t){}),delete this.image[e]))}}}(jQuery);